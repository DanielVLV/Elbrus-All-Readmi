# [Содержание](../README.md)
# SQL

Декларативный язык, применяемый для создания, модификации и управления данными в реляционной системе управления базами данных (РСУБД).

В круг ответственности SQL входит добавление данных, извлечение по запросу, обновление и их удаление, а также создание и изменение схемы реляционной БД и контроль прав доступа к данным.

## Часто используемые типы данных

- `serial`: представляет автоинкрементирующееся числовое значение, которое занимает 4 байта и может хранить числа от 1 до 2147483647. Значение данного типа образуется путем автоинкремента значения предыдущей строки. Поэтому, как правило, данный тип используется для определения идентификаторов строки.
- `integer`: хранит числа от -2147483648 до +2147483647. Занимает 4 байта. Имеет псевдонимы int и int4.
- `double precision`: хранит числа с плавающей точкой из диапазона от 1E-307 до 1E+308. Занимает 8 байт. Имеет псевдоним float8.
- `character varying(n)`: представляет строку из фиксированного количества символов. С помощью параметра задается максимальное количество символов в строке. Имеет псевдоним varchar(n).
- `timestamp` или `timestamptz`: хранит дату и время. Занимает 8 байт. Для дат самое нижнее значение - 4713 г до н.э., самое верхнее значение - 294276 г н.э.
- `boolean` может хранить одно из двух значений: true или false.

## Работа с БД из консоли

На UBUNTU выполняем команду `sudo -i -u postgres`
Потом выполняем команду `psql` чтобы попасть в консольного клиента PostgrsQL
Чтобы создать пользователя воспользуйтесь командой  
`CREATE USER test_user WITH password 'qwerty';`

Чтобы создать базу используется команда `CRЕATE DATABASЕ`,
а ее владелец назначается с помощью параметра `OWNЕR`  
`CREATE DATABASE test_database OWNER test_user;`

Можно также дать пользователю права на существующую базу  
`GRANT ALL privileges ON DATABASE test_db TO test_user;`

Для удаления базы данных можно воспользоваться командой  
`DROP DATABASE test_db;`

## Работа со структурой БД

Вы можете создать таблицу, указав её имя и перечислив все имена столбцов и их типы:

```sql
CREATE TABLE students (
    id serial PRIMARY KEY,
    nаme varchar(80),
    age integer
);
```

Добавление нового поля в таблицу

```sql
ALTER TABLE students
ADD email varchar(20);
```

Связывание двух таблиц через айди

```sql
ALTER TABLE students ADD FOREIGN KEY (`group_id`) REFERENCES groups;
```

Для удаления таблицы
`'DROP TABLE jockeys'`

## Получение данных

Получение всех данных из таблицы студенты  
`SELECT * FROM students;`

Получение полей `name` и `age`  
`SELECT name, age FROM students;`

Получение всех данных для стеднтов, чей возраст меньше 18  
`SELECT * FROM students WHERE age < 18;`

Получение всех данных с сортировкой по возрастанию возраста  
`SELECT * FROM students ORDER BY age ASC;`

Получение всех данных с сортировкой по убыванию возраста
`SELECT * FROM students ORDER BY age DESC;`

Вычисление среднего возраста студентов  
`SELECT AVG(age) AS 'Средний возраст' FROM students;`

Получение данных из нескольких таблиц  
`SELECT * FROM students JOIN groups ON students.group_id = groups.id`

Таблица Employees. Получить список всех сотрудников у которых последняя буква в имени равна 'a'

`SELECT * FROM employees WHERE first_name LIKE '%a';`

Покажите список сотрудников (employees), чье имя начинается с "A"
`SELECT * FROM employees WHERE first_name LIKE 'A%';`

Покажите список всех счетов из Редмонда (Redmond), штат Вашингтон (WA)
`SELECT * FROM invoices WHERE billing_city LIKE 'Redmond'`

Покажите список всех счетов на сумму более $5,00 из г. Reno, шт. NV
`SELECT *  FROM invoices WHERE billing_state = 'NV' AND total > 5.00`

Покажите список каждого трека без композитора (composer) (Поиск строк которые пустые)
`SELECT * FROM  yourTable WHERE yourColumn IS NULL OR yourColumn = ''`

## Изменение данных

Вы можете изменять любые данные в таблице, указав условие:
`UPDATE students SET age = 26 WHERE name = 'Anna';`

## Удаление данных

Вы можете удалить запись из БД, например указав конкретный id записи  
`DELETE FROM students WHERE id = 1;`

Эта команда удалит всех студентов, чье имя = 'Anna'  
`DELETE FROM students WHERE name = 'Anna';`  
_Удаление не по id возможно, но считается плохой практикой_

## Типы ключей

- primary key - столбец, который в базе данных должен быть уникальным и, который используется для однозначной идентификации записи
- unique key - столбец или набор столбцов, для которого/которых значения не повторяются
- foreign key - это столбец в дочерней таблице, который в точности соответствует столбцу в родительской таблице, который определен как первичный (или уникальный) ключ, и ссылается на него.

Требования к ключам:

1. уникальность
2. долговечность
3. минимальность
